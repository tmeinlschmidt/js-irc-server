var _ = require("underscore-min");

// parse prefix "class"

var CommandPrefix = function(prefix) {
  this.prefix = prefix;
  // params
  this.servername = null;
  this.nickname = null;
  this.user = null;
  this.host = null;
  this.parsePrefix();
}

CommandPrefix.prototype.parsePrefix = function() {
  // there's no prefix
  if (this.prefix == undefined) return;
  var parsable = this.prefix;
  // just servername
  if (parsable.match(/!/) == null) {
    this.servername = parsable;
    return;
  }
  // parse nick!username@host
  var arr = parsable.match(/^([^!]*)!([^@]*)@(.*)$/);
  if (arr == null) return;
  this.nickname = arr[1];
  this.user = arr[2];
  this.host = arr[3];
}

// parse command line "class"
  
CommandLine = function() {
  this._data = null;
  this.command = null;
  this.message = null;
  this.prefix = null;
  this.options = null;
}

CommandLine.prototype.parse = function (data) {
  this._data = data.trim();
  // parse command string
  var par = this._data.match(/([:]([^ ]*)|)[ ]?([^ ]*)[ ]?([^:]*)[:]?(.*)/)
  this.prefix = new CommandPrefix(par[2]);
  this.command = par[3].toUpperCase();
  this.options = _.reject(par[4].replace(/\s+/g,' ').replace(/^\s+|\s+$/g,'').split(/ /), function(r) {return (r==='')});
  this.message = par[5];
}

//var myIRCCommand = new IRCCommand(":myfriend!~colin@82-41-206-190.cable.ubr11.edin.blueyonder.co.uk PRIVMSG myNickNick :cau!");
//var myIRCCommand = new IRCCommand(":Tracey`^!me@68.178.52.73 PRIVMSG #game1 :She's dead. Keep laughing.");
//var myIRCCommand = new IRCCommand("MSG options options2 :cauka");

//myIRCCommand.parse();
exports.CommandLine = CommandLine
